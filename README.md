# IIITH API

A FastAPI-based secure and performant REST API that performs basic arithmetic operations (addition, multiplication, even/odd check) with built-in:

- JWT Authentication with Role-based Access
- Database Logging of Requests & Responses
- Admin-only Log Retrieval (with Pagination)
- Swagger/OpenAPI Documentation
- Unit & Performance Testing

## 🚀 Features

- ➕ **Arithmetic Operations**: `/add`, `/multiply`, `/check-even-odd`
- 🔐 **Authentication**: JWT token-based login (`/token`)
- 🧑‍💼 **Role-based Access**: Admin-only `/logs` endpoint
- 📝 **Request/Response Logging** stored in SQLite
- 📄 **API Docs** at `/docs` (Swagger) & `/redoc`
- 🧪 **Unit Tests** via `pytest`
- 📈 **Performance Testing** via `locust`

## 📦 Technologies

- **Backend Framework**: FastAPI
- **Auth**: OAuth2PasswordBearer + JWT (via `python-jose`)
- **Database**: SQLite (via SQLAlchemy ORM)
- **Testing**: `pytest`, `locust`
- **Docs**: Auto-generated by FastAPI (Swagger/OpenAPI)

## 🛠️ Installation

1. Clone the repository:
   ```bash
   git clone https://github.com/Imsachin010/iiith-api.git
   cd iiith-api
   ```

2. Create and activate a virtual environment:
   ```bash
   python -m venv venv
   source venv/bin/activate  # On Windows use `venv\\Scripts\\activate`
   ```

3. Install dependencies using setup.py:
   ```bash
   pip install -e .
   ```
   This will automatically install all required packages defined in setup.py.

## 🚀 Running the Server

Start the development server:
```bash
uvicorn app.main:app --reload
```

The API will be available at `http://127.0.0.1:8000`

## 📚 API Documentation

- **Swagger UI**: Visit `http://127.0.0.1:8000/docs`
- **ReDoc**: Visit `http://127.0.0.1:8000/redoc`

## 🔑 Authentication

1. Get a token using the `/token` endpoint:
   ```bash
   curl -X POST "http://127.0.0.1:8000/token" \
        -H "Content-Type: application/x-www-form-urlencoded" \
        -d "username=admin&password=adminpass"
   ```

2. Use the token in subsequent requests:
   ```bash
   curl -X GET "http://127.0.0.1:8000/logs" \
        -H "Authorization: Bearer <your_token>"
   ```

## 🧪 Testing

### Unit Tests
Run unit tests using pytest:
```bash
pytest tests/
```

### Performance Testing

#### 1. Starting the API Server
First, ensure your API server is running:
```bash
# Start the FastAPI server
uvicorn app.main:app --reload

# The server will be available at:
# http://127.0.0.1:8000
```

#### 2. Running Locust Tests
In a new terminal window:
```bash
# Install locust if not already installed
pip install locust

# Run locust with our test file
locust -f locustfile.py --host=http://127.0.0.1:8000
```

#### 3. Configuring and Running Tests in Locust Web Interface
1. Open your browser and navigate to `http://localhost:8089`
2. Configure the test parameters:
   - **Number of users**: Start with 100
   - **Spawn rate**: Set to 10 users/second
   - **Run time**: Set to 5 minutes
3. Click "Start swarming" to begin the test
4. Monitor real-time statistics:
   - Response times
   - Request rates
   - Failure rates
   - Number of users

#### 4. Understanding Test Results
The test will simulate:
- Multiple concurrent users
- Different API endpoints
- Authentication flows
- Various payload sizes

Key metrics to monitor:
- **Response Time**: Should be under 200ms for most requests
- **Requests/sec**: Higher is better
- **Failure Rate**: Should be close to 0%
- **User Count**: Should match your configuration

#### 5. Generating Performance Reports
After the test completes:
```bash
# Generate the performance report
python generate_performance_report.py
```

The script will create two files:
1. `performance_report.json`: Contains raw performance data
   - Response times
   - Success rates
   - Error counts
   - Request counts

2. `performance_report.html`: Visual report with:
   - Summary statistics
   - Performance graphs
   - Endpoint-specific metrics
   - Recommendations

#### 6. Interpreting the Report
The performance report includes:
- **Overall Performance**:
  - Total requests processed
  - Average response time
  - Success rate
  - Error rate

- **Per-Endpoint Metrics**:
  - `/add`: Addition operation performance
  - `/multiply`: Multiplication operation performance
  - `/check-even-odd`: Even/Odd check performance
  - `/logs`: Admin endpoint performance

- **Authentication Performance**:
  - Token generation time
  - Authentication success rate
  - Token validation overhead

#### 7. Performance Optimization Tips
Based on the test results:
1. If response times are high:
   - Check database queries
   - Optimize authentication flow
   - Review logging overhead

2. If failure rates are high:
   - Check error handling
   - Verify authentication
   - Monitor resource usage

3. If request rates are low:
   - Optimize code paths
   - Review database indexes
   - Check server resources

## 📝 API Endpoints

### Operations
- **POST `/add`**: Add two numbers
  ```json
  {
    "num1": 5,
    "num2": 3
  }
  ```

- **POST `/multiply`**: Multiply two numbers
  ```json
  {
    "num1": 4,
    "num2": 2
  }
  ```

- **GET `/check-even-odd`**: Check if a number is even or odd
  ```
  /check-even-odd?number=7
  ```

### Admin
- **GET `/logs`**: Retrieve operation logs (admin only)
  ```
  /logs?limit=10&offset=0
  ```

## 📄 License

This project is licensed under the MIT License. 